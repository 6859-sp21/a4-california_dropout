<!DOCTYPE html>
<html lang="en">

<head>

    <title>California Dropout</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--font-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@200;300;400;500;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

    <!--boostrap 'n libraries-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!--D3 library-->
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    <script src="js/d3-sankey.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>

    
    <!--Arquero library-->   
    <!-- <script src="https://cdn.jsdelivr.net/npm/apache-arrow@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/arquero@latest"></script> -->

    <!--styles-->
    <!-- <link rel="stylesheet" href="css/styles.css"> -->
    <!-- <link rel="stylesheet" href="css/table.css"> -->

    <!-- Load d3.js and the geo projection plugin -->
    <!-- <script src="https://d3js.org/d3.v4.js"></script> -->
    <!-- <script src="https://d3js.org/d3-geo-projection.v3.min.js"></script> -->

    <link rel="shortcut icon" href="#">

</head>

<body>
    <section id="title">
        <h1>CALIFORNIA PUBLIC SCHOOL DROPOUT</h1>
        <h5>What are the key drivers of Public School Dropout in California?</h3>
    </section>

    <!-- <div class="container">
        <div class="row">
          <div class="col-4 background">
            <h4>Background Info</h4>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis suscipit maiores eos cupiditate. Ex fugit necessitatibus optio corporis cum similique accusamus unde deserunt quaerat commodi? Laboriosam deserunt saepe obcaecati dolorem.</p>
            <img src="img/Geographic.png" alt="" style="width: 100%">
            <img src="img/legend-g.png" alt=""  style="width: 40%">
            <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Eveniet blanditiis illum sapiente, ea laudantium doloribus vero hic! Quisquam autem ea sint eius, eligendi ducimus, magni illo beatae deleniti, culpa aliquam?</p>
            <button class="b-b">Download Data</button>
          </div>
          <div class="col-8">
              <h4>Demographic Data Correlation</h4>
              <div id="filter">
                <div id="yearfilter">
                    <button id="allyear" class = "b-b" value="false" onclick="allyear();">Show All Year Instead</button>
                    <input type="range" min="1991" max="2016" value="1993" class="selectors slider" id="yearRange">
                    <span>Year: <span id="selectedyear">1993</span></span>
                </div>
            
                <div id="selectors">
                    <form>
                        <select id="partA" class="selectors">
                            <option value="gender" selected="selected">Gender</option>
                            <option value="ethnic">Ethnicity</option>
                            <option value="grade">Grade</option>
                            <option value="county">County</option>
                        </select>
                    </form>
                    <span>To</span>
                    <form>
                        <select id="partB" class="selectors">
                            <option value="gender">Gender</option>
                            <option value="ethnic" selected="selected">Ethnicity</option>
                            <option value="grade">Grade</option>
                            <option value="county">County</option>
                        </select>
                    </form>
                    <span id="warning"></span>
                </div>
              </div>
            
          </div>
        </div>
      </div>
     -->

    <!-- <div id="sankey"></div> -->
    <!-- <div id="bar"></div> -->
    <!-- <div id="bar2"></div>     -->

    <!-- Button -->
    <!-- <div>
        <input type="checkbox" class="checkbox" value="A" checked><label>group A</label>
        <input type="checkbox" class="checkbox" value="B" checked><label>group B</label>
        <input type="checkbox" class="checkbox" value="C" checked><label>group C</label>
    </div> -->
    
    <!-- Create an element where the map will take place -->
    <style>
        .circle:hover{
          stroke: black;
          stroke-width: 4px;
        }
        path {
            stroke: white;
            stroke-width: 0.25px;
            fill: grey;
            }
    </style>
    <div id="calimap"></div>
    
    <!-- <div id="event"></div> -->



    <!--bootstrap-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!--personal js-->
    <!-- <script src="./js/main.js"></script> -->
    <!-- <script src="./js/sankey-vis.js"></script> -->
    <!-- <script src="./js/bar-vis.js"></script> -->
    <!-- <script src="./js/bar-vis2.js"></script> -->
    <!-- <script src="./js/event-table.js"></script> -->
    <!-- <script src="./js/geomap.js"></script> -->
    
    <script>
        callout = (g, value) => {
            if (!value) return g.style("display", "none");

            g
                .style("display", null)
                .style("pointer-events", "none")
                .style("font", "10px sans-serif");

            const path = g.selectAll("path")
                .data([null])
                .join("path")
                .attr("fill", "white")
                .attr("stroke", "black");

            const text = g.selectAll("text")
                .data([null])
                .join("text")
                .call(text => text
                .selectAll("tspan")
                .data((value + "").split(/\n/))
                .join("tspan")
                    .attr("x", 0)
                    .attr("y", (d, i) => `${i * 1.1}em`)
                    .style("font-weight", (_, i) => i ? null : "bold")
                    .text(d => d));

            const {x, y, width: w, height: h} = text.node().getBBox();

            text.attr("transform", `translate(${-w / 2},${15 - y})`);
            path.attr("d", `M${-w / 2 - 10},5H-5l5,-5l5,5H${w / 2 + 10}v${h + 20}h-${w + 20}z`);
        }
        format = d => `County: ${d}`

        var mapWidth = 640,
            mapHeight = 640;
        
            mercator = d3
                .geoMercator()
                .center([-119, 37.4])
                .scale((1 << 18) / (28 * Math.PI))
                .translate([320, 320])
                            
        var path = d3.geoPath().projection(mercator);

        var svg = d3.select("#calimap").append("svg")
            .attr("width", mapWidth)
            .attr("height", mapHeight);

        d3.json("./data/california-counties@1.topojson").then(function(json) {
            const counties = topojson.feature(json, json.objects.counties);

            // <g> grouping element
            const g = svg.append('g');

            // get another data
            d3.json("./sankeydata/county-gender.json").then(function(json_data) {

                // filter data
                console.log(json_data)
                var county2num = {};
                const selectedYear = 2000;
                for (var key in json_data) {
                    county2num[key] = 0;
                    for (var gender in json_data[key]) {
                        if (json_data[key][gender] != undefined && json_data[key][gender][selectedYear] != undefined) {
                            // console.log(json_data[key][gender][selectedYear])
                            county2num[key] += json_data[key][gender][selectedYear];
                        }
                    }
                }

                // color
                color = d3.scaleSequentialQuantile(Object.values(county2num), d3.interpolateBlues);

                g.append("g")
                .selectAll("path")
                .data(counties.features)
                .join("path")
                .attr("d", path)
                .attr("class", "county")
                // .attr("fill", d => color(county2num[d.properties.NAME]))
                .style('fill', function(d) {
                    if (county2num[d.properties.NAME] != undefined) {
                        // console.log(color(county2num[d.properties.NAME]));
                        return county2num[d.properties.NAME] == 0 ? "rgb(213,222,217)" : color(county2num[d.properties.NAME]);
                    } else {
                        console.log(d.properties.NAME);
                        return "rgb(213,222,217)";
                    }})
                .style("stroke", "white")
                .style('stroke-width', 1)
                .append("text")
                .text(function(d){
                    return d.properties.NAME;
                })
                // .text(d => d.properties.County)

                // tooltip
                const tooltip = svg.append("g");
                svg
                .selectAll(".county")
                .on("touchmove mousemove", function(event, d) {
                tooltip.call(
                    callout,
                    `${format(d.properties.NAME)}
                     ${county2num[d.properties.NAME] != undefined ? county2num[d.properties.NAME] : 0} dropout(s)`
                );
                tooltip.attr("transform", `translate(${d3.pointer(event, this)})`);
                d3.select(this)
                    .attr("stroke", "red")
                    .raise();
                })
                .on("touchend mouseleave", function() {
                tooltip.call(callout, null);
                d3.select(this)
                    .attr("stroke", null)
                    .lower();
                });

                // county name
                // g.append("g")
                // .attr("class", "county-names")
                // .selectAll("text")
                // .data(counties.features)
                // .enter()
                // .append("svg:text")
                // .text(function(d){
                //     return d.properties.NAME;
                // })
                // .attr("x", function(d){
                //     return path.centroid(d)[0];
                // })
                // .attr("y", function(d){
                //     return  path.centroid(d)[1];
                // })
                // .attr("text-anchor","middle")
                // .attr('fill', 'white');
                                
        })

        })


        

        
       
    </script>
    
<!--    <script src="./js/sankey-update.js"></script>-->

</body></html>


